# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Основные типы данных
Тип данных категории карточки
```
type TCardCategory = 'софт-скил' | 'хард-скил' | 'другое' | 'дополнительное' | 'кнопка';
```
Карточка
```
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: TCardCategory;
    price: number | null;
}
```
Заказ
```
interface IOrderForm {
    payment: string;
    email: string;
    phone: string;
    address: string;
}
```
Корзина 
```
interface IOrder extends IOrderForm {
    items: string[];
    total: number;
}
```
Модель данных карточки
```
interface ICardsData {
    cards: ICard[];
    setCards(cards: ICard[]): void;
    getCards(): ICard[];
}
```
Модель данных корзины
```
interface IBasketData {
    cards: ICard[];
    addCard(card: ICard): void;
    getCards(): void;
    getCardsList(): string[];
    delCard(_id: string): void;
    delCards(): void;
    getTotalPrice(): void;
    include(_id: string): boolean;
    count(): number;
}
```
Модель данных заказа
```
interface IOrderData {
    order: IOrderForm;
    setField(field: keyof IOrderForm, value: string): void;
    getOrder(): IOrderForm;
    validate(): TFormErrors;
    reset(): void;
}
```
Данные о успешном заказе
```
interface IOrderResult {
    id: string[];
    total: number;
}
```
Данные карточки на главной странице
```
type TCardCatalog = Pick<ICard, 'category' | 'image' | 'title' | 'price'>;
```
Данные для просмотра одной карточки
```
type TCardPreview = Pick<ICard, 'description'> & TCardCatalog;
```
Данные представления карточки в корзине
```
type TCardBasket = Pick<ICard, 'title' | 'price'> & { sequence: number; }
```
Данные валидации при оформлении заказа
```
type TFormErrors = Partial<Record<keyof IOrderForm, string>>;
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме, MVP:

- Слой данных. Отвечает за хранение и изменение данных.
- Слой представления. Отвечает за отображение данных на странице.
- Презентер. Отвечает за связь слоя представления и слоя данных.

## Базовый код

### Класс Api
Отвечает за запросы на сервер. 
- constructor(baseUrl: string, options: RequestInit = {})- принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы:

- get - используются для получения информации с сервера. Принимает в параметр Endpoint (указание на конкретный ресурс, к которому мы хотим получить доступ). Выполняет get запрос и возвращает promise (данные с сервера).

- post - используются для отправки информации на сервер. Принимает в параметр Endpoint, объект для передачи в JSON и метод запроса (по умолчанию post).

- handleResponse - преобразует данные в формат, в котором мы хотим получить данные. Принимает в параметр поток Response. Возвращает promise, который разрешается в результат разбора тела ответа в качестве стоки JSON

### Класс Component
Абстрактный класс для создания DOM-элементов.

- constructor(protected readonly container: HTMLElement)- принимает в параметры конструктора контейнер, куда будет вставляться в DOM-элемент.

Методы:

- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает класс. Принимает в параметры элемент, название класса, и по необходимости - Логическое значение force. 

- setText(element: HTMLElement|HTMLButtonElement, value: unknown) - устанавливает текстовое содержимое элементу. Принимает в параметры элемент и значение, которое нужно установить.

- setDisabled(element: HTMLElement, state: boolean) - меняет статус блокировки. Принимает в параметры элемент и статус, при котором необходима блокировка.

- setHidden(element: HTMLElement) - скрывает элемент. Принимает в параметры элемент, который необходимо скрыть.

- setVisible(element: HTMLElement) - показывает элемент. Принимает в параметры элемент, который необходимо показать.

- setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение с алтернативным текстом Принимает в параметры элемент картинки, адрес и, по необходимости, описание (альтернативный текст)

- render(data?: Partial<T>): HTMLElement - вставляет корневой DOM-элемент в разметку.

### Класс EventEmitter

Брокер событий. Позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. Основные методы, реализуемые классом описаны интерфейсом IEvents.

Методы:

- emit - инициирует событие. Принимает в параметры имя события и данные, которые будут переданы в качестве параметров для функций обработчиков.

- on - устанавливает слушатель на событие (заменяет addEventListener). Принимает в параметры название события и функцию callback.

- off - снимает слушатель с события. Принимает в параметры название события и функцию callback.

- onAll - устанавливает слушатель на все события.
Принимает в параметр функцию callback.

- offAll - снимает все слушатели.

- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Класс Model
 Базовая модель, чтобы можно было отличить ее от простых объектов с данными. constructor(data: Partial<T>, protected events: IEvents) {
        Object.assign(this, data);
    }
    принимает в параметр экземпляр EventEmitter для инициации событий и тип данных с опциональными полями.
 
## Модель данных
### Класс CardsData
Хранит данные карточки.
Данные:
_cards: ICard[] - массив объектов карточек загруженных с сервера.
Методы:
- setCards(cards: ICard[]): void- полученные данные с сервера о карточках добавляются в массив карточек, инициализация события изменения/отображения карточек на главной странице
- getCards(): ICard[] - получение массива карточек

### Класс BasketData
Хранение данных корзины. Отвечает за хранение и работу с данными

В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек, которые добавлены в корзину.

Методы класса:
- addCard(card: ICard): void - добавляет карточку в корзину, инициализирует событие обновление корзины.
- getCards(): void - получение массива карточек, которые находятся в корзине.
- getCardsList(): string[] - формирует массив из id, карточек которые находятся в корзине.
- delCard(_id: string): void - удаление  карточки из корзины по id карточки.
- delCards(): void - задает пустой массив карточек для коризы.
- getTotalPrice(): void - считает общую стоимость корзины.
- include(_id: string): boolean -  проверяет есть данный товар в корзине.
- count(): number - определяет общее количество карточек в корзине.

### Класс OrderData 
Хранение данных о заказе
Данные:
- payment - способ оплаты.
- email - электронный адрес.
- phone - телефон.
- address - адрес.

Методы:
- setField(field: keyof IOrderForm, value: string): void - значение поля заполенное пользователем на форме заказа сохраняется в данных класса.
- getOrder(): IOrderForm - получение данных заказа.
- validate(): TFormErrors - проверяет заполнены ли данные и формирует текст для вывода ошибки.
- reset(): void - цикл для удаления данных в каждом параметре.

## Компоненты представления

Все классы представления отвечаю за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

### Класс Card
Отвечает за отображение общих данных карточки, задавая в карточке данные названия, цены и события кнопки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия, с которыми  генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки.

constructor(protected template: HTMLTemplateElement, actions?: ICardActions)- принимает в параметры темплейт и событие клика мыши

Методы:
set title(value: string) - устанавливает значение название в разметке карточки.
set price(value: number)  - устанавливает цену карточки в разметке карточки.

### Класс CardCatalog
Отвечает за отображение карточек на главной странице. Поля класса содержат элементы разметки элементов карточки. Конструктор принимает в параметры шаблона и событие клика мыши.

Методы:
- set category(value: keyof typeof categoryColor) - устанавливает название категории карточки и цвет фона
- set image(value: string) - добавляет ссылку на картинку в разметку карточки

### Класс CardPreview
Отвечает за отображение при открытии отдельной карточки в модальном окне. Поля класса содержат элементы разметки элементов карточки. Конструктор принимает в параметры шаблона и событие клика мыши.

Методы:
set description(value: string) - Устанавливает описание карточки
set inBasket (value: boolean) - изменяет название кнопки на карточке, если она уже добавлена в корзину

### Класс CardBasket
Отвечает за отображение карточки в корзине. Поля класса содержат элементы разметки элементов карточки. Конструктор принимает в параметры шаблона и событие клика мыши.

Методы:
set sequence(value: number) - Устанавливает порядковый номер карточки в корзине

### Класс Page
Отвечает за отображение данных на главной странице: галереи и иконки корзины. Поля класса содержат элементы разметки элементов главной страницы. Конструктор принимает в параметры шаблон и экземпляр EventEmitter для инициации событий.

Методы:
- set locked(locked: boolean) - для блокировки и разблокировки прокрутки страницы при открытии модального окна
сеттеры для сохранения данных в полях класса

### Класс Basket
Отвечает за отображение данных на корзине: список карточек добавленных в корзину и общую стоимость корзины. Поля класса содержат элементы разметки корзины. Конструктор принимает в параметры шаблон и экземпляр EventEmitter для инициации событий.

Методы:
- set cards(items: HTMLElement[]) - формирует список с карточками добавленными в корзину
- set total(value: number) - устанавливает общую стоимость корзины

### Класс Modal
Реализует модальное окно. Так же предоставляет методы open и close для управления отображением модального окна. Устанавливает слушатели для закрытия модального окна по клику в оверлей и кнопку-крестик для закрытия попапа. Конструктор принимает в параметры шаблон и экземпляр EventEmitter для инициации событий.

### Класс Order
Отвечает за отображение общих элементов для форм с данными по заказу. Конструктор принимает в параметры шаблон и экземпляр EventEmitter для инициации событий.
В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия, с которыми генерируются соответствующие события.\ Используются сеттеры для сохранения данных в поля класса

Методы:
- onInputChange(field: keyof T, value: string) - инициализирует запись о данных в модель данных заказа
- set valid(value: boolean)  - отвечает за блокировку кнопки для перехода на следующую форму, устанавливает класс для изменения цвета ошибки.
- set error(value: string) - устанавливает текст ошибки

### Класс OrderForm
Отвечает за отображение данных на форме: способ оплаты и адреса. Наследует поля и методы от класс Order Конструктор принимает в параметры шаблон и экземпляр EventEmitter для инициации событий.
Используются сеттеры для отображения данных в разметке формы.

### Класс ContactsForm
Отвечает за отображение данных на форме с контактами: почта и телефон. Наследует поля и методы от класс Order Конструктор принимает в параметры шаблон и экземпляр EventEmitter для инициации событий.
Используются сеттеры для отображения данных в разметке формы.

### Класс Success
Отвечает за отображение успешного оформления заказа в модальном окне. В классе устанавливается слушатель на кнопку для взаимодействия пользователя.

Методы:
- set total(value: number) - устанавливает стоимость заказа

## Слой коммуникации

### Класс AppApi
Клас наследуюется от класса Api. Конструктор принимает адрес для отображения картинки и адрес сервера для отправки запросов. Класс предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

Методы
- getCards(): Promise<ICard[]> - получение карточек с сервера
- postOrder(order: IOrder): Promise<IOrderResult> - отправка заказа на сервер

### Взаимодействие компонентов
Код описывающий взаимодействие представления и данных между собой, находится в файле index.ts, который выполняет роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список событий:
 - cards:changed - обновление массива карточек
 - card:select - открытие карточки
 - card:addBasket - удаление карточки из корзины
 - card:deleteBasket - добавление карточки в корзину
 - basket:changed - изменение корзины
 - basket:open - открытие корзины
 - order:open - открытие формы для оформления заказа
 - order:change - изменение формы заказа и контакта
 - order:submit - открытие формы с контактами
 - contacts:submit -  оформление заказа








